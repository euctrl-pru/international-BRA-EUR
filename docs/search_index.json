[["covidh1.html", "COVID Briefing", " COVID Briefing The present section aims to compare the impact of COVID-19 crisis on air traffic in Brazil and Europe #Load relevant packages library(tidyverse) ## Warning: package &#39;tidyverse&#39; was built under R version 4.0.4 ## -- Attaching packages --------------------- tidyverse 1.3.0 -- ## v ggplot2 3.3.3 v purrr 0.3.4 ## v tibble 3.0.3 v dplyr 1.0.2 ## v tidyr 1.1.2 v stringr 1.4.0 ## v readr 1.4.0 v forcats 0.5.0 ## Warning: package &#39;ggplot2&#39; was built under R version 4.0.5 ## Warning: package &#39;readr&#39; was built under R version 4.0.4 ## Warning: package &#39;forcats&#39; was built under R version 4.0.3 ## -- Conflicts ------------------------ tidyverse_conflicts() -- ## x dplyr::filter() masks stats::filter() ## x dplyr::lag() masks stats::lag() library(readr) library(dplyr) library(ggplot2) library(ggrepel) library(maps) ## Warning: package &#39;maps&#39; was built under R version 4.0.3 ## ## Attaching package: &#39;maps&#39; ## The following object is masked from &#39;package:purrr&#39;: ## ## map library(patchwork) library(flextable) ## Warning: package &#39;flextable&#39; was built under R version 4.0.5 ## ## Attaching package: &#39;flextable&#39; ## The following object is masked from &#39;package:purrr&#39;: ## ## compose library(lubridate) ## Warning: package &#39;lubridate&#39; was built under R version 4.0.3 ## ## Attaching package: &#39;lubridate&#39; ## The following objects are masked from &#39;package:base&#39;: ## ## date, intersect, setdiff, union library(zoo) ## Warning: package &#39;zoo&#39; was built under R version 4.0.3 ## ## Attaching package: &#39;zoo&#39; ## The following objects are masked from &#39;package:base&#39;: ## ## as.Date, as.Date.numeric #Read relevant data bra_count_airport &lt;- read_csv(&quot;../PBWG-2021/data/PBWG-BRA-airport-traffic.csv&quot;) %&gt;% mutate(APT_ICAO = as.factor(APT_ICAO)) ## ## -- Column specification -------------------------------------- ## cols( ## APT_ICAO = col_character(), ## DATE = col_date(format = &quot;&quot;), ## ARRS = col_double(), ## DEPS = col_double(), ## HEAVY = col_double(), ## MED = col_double(), ## LIGHT = col_double(), ## ARRS_DOM = col_double(), ## DEPS_DOM = col_double() ## ) eur_count_airport &lt;- read_csv(&quot;../PBWG-2021/data/PBWG-EUR-airport-traffic.csv&quot;) %&gt;% mutate(APT_ICAO = as.factor(ICAO), .before = DATE, .keep = &quot;unused&quot;) ## ## -- Column specification -------------------------------------- ## cols( ## ICAO = col_character(), ## DATE = col_date(format = &quot;&quot;), ## ARRS = col_double(), ## DEPS = col_double(), ## HEAVY = col_double(), ## MED = col_double(), ## LIGHT = col_double(), ## ARRS_DOM = col_double(), ## DEPS_DOM = col_double() ## ) "],["scope.html", "Scope Brazil Europe", " Scope This briefing includes data from the following airports: #useful filters bra_10_apts &lt;- c(&quot;SBBR&quot;, &quot;SBGR&quot;, &quot;SBSP&quot;, &quot;SBKP&quot;, &quot;SBRJ&quot;, &quot;SBGL&quot;, &quot;SBCF&quot;, &quot;SBSV&quot;, &quot;SBPA&quot;, &quot;SBCT&quot;) eur_apts &lt;- c(&quot;EHAM&quot;,&quot;LFPG&quot;,&quot;EGLL&quot;,&quot;EDDF&quot;,&quot;EDDM&quot;,&quot;LEMD&quot;,&quot;LIRF&quot;,&quot;LEBL&quot;,&quot;EGKK&quot;,&quot;LSZH&quot;) scope_function &lt;- . %&gt;% filter(year(DATE) %in% 2019:2021 &amp; APT_ICAO %in% c(bra_10_apts, eur_apts)) %&gt;% drop_na() bra_count_airport &lt;- bra_count_airport %&gt;% scope_function() eur_count_airport &lt;- eur_count_airport %&gt;% scope_function() #head(bra_count_airport) #head(eur_count_airport) Brazil SBBR, SBCF, SBCT, SBGL, SBGR, SBKP, SBPA, SBRJ, SBSP, and SBSV Europe European airports are EDDF, EDDM, EGLL, EHAM, LEMD, LFPG, LIRF, and LSZH "],["in-review.html", "2020 in Review Daily Traffic 0.1 Total impacts Impacts on international flows Impacts on airport level 0.2 Background 0.3 Scope 0.4 Data Sources 0.5 Structure of the Report 0.6 Organisation of Air Navigation Services 0.7 High-Level System Comparison 0.8 Annual Traffic 0.9 Peak Day Traffic 0.10 Fleet Mix 0.11 Arrival Punctuality 0.12 Departure Punctuality 0.13 Peak Declared Capacity 0.14 Peak Arrival Throughput 0.15 Peak Departure Throughput 0.16 Declared Capacity and Peak Throughput 0.17 Capacity Utilisation 0.18 Additional Taxi-In Time 0.19 Additional Taxi-Out Time 0.20 Additional Time in Terminal Airspace", " 2020 in Review The COVID-19 pandemic hit all countries worldwide, but at different moments. In Europe, the first case was registered in January 24, 2020, in France. Approximately one month later, the first patient in Brazil was officially announced in February 26, 2020. In March 11, 2020, the World Health Organization declared the crisis a global pandemic. As a result, the air transport industry suffered a severe drop in demand, in Brazil and Europe. Figures REFERENCE1 and REFERENCE2 below shows the daily traffic for the both regions. Daily Traffic ## TO DO #1. year comparison chart #2. first four months comparisons #defining reference percentile ref_pct &lt;- 0.5 #utility function daily_reg_count &lt;- . %&gt;% group_by(DATE) %&gt;% summarize(MVTS = sum(ARRS, DEPS), MVTS_INT = sum(ARRS-ARRS_DOM, DEPS-DEPS_DOM)) %&gt;% mutate(MVTS_NORM = MVTS / quantile(MVTS[year(DATE)==2019], probs = ref_pct), MVTS_INT_NORM = MVTS_INT / quantile(MVTS_INT[year(DATE)==2019], probs = ref_pct) ) eur_count_norm &lt;- eur_count_airport %&gt;% daily_reg_count() %&gt;% mutate(REG = &quot;EUR&quot;) ## `summarise()` ungrouping output (override with `.groups` argument) #creating eur rolling avgs eur_count_norm &lt;- eur_count_norm %&gt;% mutate(MVTS_ROLLAVG = rollmean(MVTS, k = 7, fill = NA), MVTS_NORM_ROLLAVG = rollmean(MVTS_NORM, k = 7, fill = NA)) bra_count_norm &lt;- bra_count_airport %&gt;% daily_reg_count() %&gt;% mutate(REG = &quot;BRA&quot;) ## `summarise()` ungrouping output (override with `.groups` argument) #creating bra rolling avgs bra_count_norm &lt;- bra_count_norm %&gt;% mutate(MVTS_ROLLAVG = rollmean(MVTS, k = 7, fill = NA), MVTS_NORM_ROLLAVG = rollmean(MVTS_NORM, k = 7, fill = NA)) counts_norm &lt;- bind_rows(bra_count_norm, eur_count_norm) counts_norm[year(counts_norm$DATE) &lt;= 2020,] %&gt;% ggplot(aes(x = DATE)) + geom_point(aes(y = MVTS, colour = REG), alpha = 0.2, size = 0.1) + geom_line(aes(y = MVTS_ROLLAVG, colour = REG), size = 1.5) + theme_minimal() + labs( title = &quot;Daily Traffic&quot; ,subtitle = &quot;Total departures and landings for selected airports&quot; ,x = NULL, y = NULL, colour = &quot;Region&quot; ,caption = &quot;The points indicate the real number, while the line indicates the 7-day rolling average&quot;) + scale_colour_manual(values = c(&quot;forestgreen&quot;, &quot;royalblue&quot;)) + scale_x_date(date_labels = &quot;%b-%y&quot;) ## Warning: Removed 6 row(s) containing missing values (geom_path). counts_norm[year(counts_norm$DATE) &lt;= 2020,] %&gt;% ggplot(aes(x = DATE)) + #geom_point(aes(y = MVTS_NORM, colour = REG), alpha = 0.2, size = 0.1) + geom_line(aes(y = MVTS_NORM_ROLLAVG, colour = REG), size = 1.5) + theme_minimal() + labs( title = &quot;Daily Traffic - Comparison&quot; ,subtitle = &quot;Total movements, normalized by the respective median&quot; ,x = NULL, y = NULL, colour = &quot;Region&quot; ,caption = &quot;The line indicates the 7-day rolling average&quot;) + scale_colour_manual(values = c(&quot;forestgreen&quot;, &quot;royalblue&quot;)) + scale_x_date(date_labels = &quot;%b-%y&quot;) ## Warning: Removed 6 row(s) containing missing values (geom_path). The initial drop happened first in Europe, but quickly followed by Brazil. During the recovery, Brazil registered a more constant increase in traffic, while Europe had a wider variation. 0.1 Total impacts ds4 &lt;- counts_norm %&gt;% group_by(REG, YR = as.factor(year(DATE))) %&gt;% summarise(MVTS = sum(MVTS), MVTS_INT = sum(MVTS_INT)) %&gt;% mutate(VAR_TO_2019 = round((MVTS-MVTS[YR==2019])/MVTS[YR==2019], 2)) ## `summarise()` regrouping output by &#39;REG&#39; (override with `.groups` argument) ds4 ## # A tibble: 6 x 5 ## # Groups: REG [2] ## REG YR MVTS MVTS_INT VAR_TO_2019 ## &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 BRA 2019 1307958 128108 0 ## 2 BRA 2020 682109 50535 -0.48 ## 3 BRA 2021 309016 17710 -0.76 ## 4 EUR 2019 4067713 906062 0 ## 5 EUR 2020 1607603 387868 -0.6 ## 6 EUR 2021 321276 106518 -0.92 g1 &lt;- ds4 %&gt;% ggplot() + aes(x = REG) + geom_col(position = position_dodge()) + aes(y = MVTS, fill = YR) + geom_text(position = position_dodge(0.9), vjust = 1.2) + aes(label = MVTS, y = MVTS) + scale_y_continuous(labels = scales::number_format(), limits = c(0, 4500000)) #g1 g2 &lt;- ds4 %&gt;% ggplot(aes(x = REG)) + geom_col(aes(y = VAR_TO_2019), fill = &quot;royalblue&quot;) + geom_text(data = ds4[ds4$YR == 2020,], aes(y = VAR_TO_2019, label = scales::percent(VAR_TO_2019, accuracy = 1)), nudge_y = 0.1, color = &quot;white&quot;) + theme(axis.title = element_blank(), axis.ticks.y = element_blank(), axis.text.y = element_blank()) #g2 g1 + inset_element(g2, left = 0.05, bottom = 0.6, right = 0.4, top = 1) #option 2 ds4 %&gt;% ggplot(aes(x = YR)) + geom_line(aes(y = MVTS, group = REG, color = REG)) + scale_y_continuous(limits = c(0, 4500000), labels = scales::label_number()) Impacts on international flows ## TODO #1.explain the definitions of Internationl for Br and EUR #2.check the connections BR-EUR, via ANAC database #3. make an alternative graph with reduced timeline? check counts_norm %&gt;% ggplot(aes(x = DATE)) + geom_line(aes(y = MVTS_INT, colour = REG)) + theme_minimal() + labs( title = &quot;PBWG - regional air traffic comparison&quot; ,subtitle = &quot;total international movements&quot; ,x = NULL, y = NULL) counts_norm %&gt;% ggplot(aes(x = DATE)) + geom_line(aes(y = MVTS_INT_NORM, colour = REG)) + theme_minimal() + labs( title = &quot;PBWG - regional air traffic comparison&quot; ,subtitle = &quot;normalised international movements&quot; ,x = NULL, y = NULL) Impacts on airport level #-----TO DO: AIRPORT BREAKDOWN #utility function annual_count &lt;- . %&gt;% group_by(APT_ICAO, YR = year(DATE)) %&gt;% summarise(MVTS = sum(ARRS, DEPS), MVTS_INT = sum(ARRS - ARRS_DOM, DEPS - DEPS_DOM)) multiple_counts &lt;- . %&gt;% mutate(INT_SHARE = round(MVTS_INT / MVTS, 2), VAR_TO_2019 = round((MVTS-MVTS[YR==2019])/MVTS[YR==2019], 2)) ds1 &lt;- eur_count_airport %&gt;% annual_count() %&gt;% multiple_counts() %&gt;% mutate(REG = &quot;EUR&quot;) ## `summarise()` regrouping output by &#39;APT_ICAO&#39; (override with `.groups` argument) ds2 &lt;- bra_count_airport %&gt;% annual_count() %&gt;% multiple_counts() %&gt;% mutate(REG = &quot;BRA&quot;) ## `summarise()` regrouping output by &#39;APT_ICAO&#39; (override with `.groups` argument) ds3 &lt;- bind_rows(ds1, ds2) #ds3 ds3 %&gt;% ggplot(aes(x = reorder(APT_ICAO, MVTS))) + geom_col(aes(y = MVTS, fill = factor(YR)), position = &quot;dodge&quot;) + facet_grid(.~REG, scales = &quot;free_x&quot;) + scale_y_continuous(labels = scales::label_number()) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5), axis.ticks = element_blank()) ds3 %&gt;% filter(YR == 2020) %&gt;% ggplot(aes(x = reorder(APT_ICAO, VAR_TO_2019))) + geom_col(aes(y = VAR_TO_2019, fill = REG)) + geom_text(aes(y = VAR_TO_2019, label = scales::percent(VAR_TO_2019, accuracy = 1)), size = 2.5, nudge_y = 0.04) + scale_y_continuous(labels = scales::percent_format(), limits = c(-0.8,0)) + coord_flip() TODO - same, but for jan-apr21 / jan-apr2019 0.2 Background 0.3 Scope 0.3.1 Geographical Scope 0.3.2 Temporal Scope 0.4 Data Sources 0.5 Structure of the Report 0.6 Organisation of Air Navigation Services 0.7 High-Level System Comparison 0.8 Annual Traffic 0.9 Peak Day Traffic 0.10 Fleet Mix 0.11 Arrival Punctuality 0.12 Departure Punctuality 0.13 Peak Declared Capacity 0.14 Peak Arrival Throughput 0.15 Peak Departure Throughput 0.16 Declared Capacity and Peak Throughput 0.17 Capacity Utilisation 0.18 Additional Taxi-In Time 0.19 Additional Taxi-Out Time 0.20 Additional Time in Terminal Airspace "]]
